<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm Marketplace Creator</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .crop-card { transition: all 0.3s ease; }
        .crop-card:hover { transform: scale(1.05); }
        .publish-btn { transition: background-color 0.3s ease; }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

</head>

<nav class="bg-white shadow sticky top-0 z-50">
    <div class="container mx-auto flex justify-between items-center py-4 px-6">
      <h1 class="text-2xl font-bold text-green-700">ðŸŒ¿ TSA</h1>
      <ul class="flex gap-5 font-medium text-sm">
        <li><a href="/" class="hover:text-green-600">Home</a></li>
        <li><a href="/planner" class="hover:text-green-600">Planner</a></li>
        <li><a href="/water" class="hover:text-green-600">Water</a></li>
        <li><a href="/dashboard" class="hover:text-green-600">Dashboard</a></li>
        <li><a href="/tips" class="hover:text-green-600">Tips</a></li>
        <li><a href="/reports" class="hover:text-green-600">Reports</a></li>
        <li><a href="/marketplace" class="hover:text-green-600">Marketplace</a></li>
      </ul>
      
    </div>
  </nav>

<body class="bg-gray-50 min-h-screen font-sans">
    <div class="container mx-auto p-6 max-w-4xl">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-green-700">Farm Marketplace Creator</h1>
            <p class="text-gray-600 mt-2">Build your sustainable marketplace in minutes</p>
        </header>

        <!-- Store Name Section -->
        <section class="mb-8 bg-white p-6 rounded-xl shadow-md">
            <label for="storeName" class="block text-lg font-semibold text-gray-800 mb-2">Marketplace Name</label>
            <input id="storeName" type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="e.g., SunnyFields Farm">
        </section>

        <!-- Crop Input Section -->
        <section class="mb-8 bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Add Your Crops</h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <select id="cropSelect" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="">Select Crop</option>
                    <option value="Wheat">Wheat</option>
                    <option value="Rice">Rice</option>
                    <option value="Corn">Corn</option>
                    <option value="Tomatoes">Tomatoes</option>
                    <option value="Potatoes">Potatoes</option>
                </select>
                <input id="price" type="number" step="0.01" min="0" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Price per kg ($)">
                <input id="quantity" type="number" min="0" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Quantity (kg)">
            </div>
            <button id="addCrop" class="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Add Crop</button>
        </section>

        <!-- Crop Preview Section -->
        <section id="cropPreview" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mb-8"></section>

        <!-- Publish Section -->
        <section class="text-center">
            <button id="publishBtn" class="publish-btn bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 text-lg font-semibold">Publish Marketplace</button>
            <div id="shareLink" class="mt-6 hidden">
                <p class="text-gray-700 mb-2">Share your marketplace:</p>
                <div class="flex justify-center items-center gap-2">
                    <input id="linkInput" type="text" class="p-2 border border-gray-300 rounded-lg w-80 bg-gray-100" readonly>
                    <button id="copyLink" class="bg-gray-200 p-2 rounded-lg hover:bg-gray-300">Copy</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const crops = [];

            // DOM Elements
            const cropSelect = document.getElementById('cropSelect');
            const priceInput = document.getElementById('price');
            const quantityInput = document.getElementById('quantity');
            const storeNameInput = document.getElementById('storeName');
            const previewSection = document.getElementById('cropPreview');
            const shareLinkSection = document.getElementById('shareLink');
            const linkInput = document.getElementById('linkInput');
            const addCropBtn = document.getElementById('addCrop');
            const publishBtn = document.getElementById('publishBtn');
            const copyLinkBtn = document.getElementById('copyLink');

            // Add Crop
            addCropBtn.addEventListener('click', () => {
                const crop = cropSelect.value;
                const price = parseFloat(priceInput.value);
                const quantity = parseInt(quantityInput.value);

                if (!crop || price <= 0 || quantity <= 0 || isNaN(price) || isNaN(quantity)) {
                    showAlert('Please fill all fields with valid values!', 'error');
                    return;
                }

                crops.push({ crop, price, quantity });
                updatePreview();
                clearForm();
                showAlert('Crop added successfully!', 'success');
            });

            // Update Preview
            function updatePreview() {
                previewSection.innerHTML = '';
                crops.forEach((item, index) => {
                    const cropCard = document.createElement('div');
                    cropCard.className = 'crop-card bg-white p-4 rounded-lg shadow-md flex flex-col justify-between';
                    cropCard.innerHTML = `
                        <div>
                            <h3 class="font-semibold text-lg text-gray-800">${item.crop}</h3>
                            <p class="text-gray-600">Price: $${item.price.toFixed(2)}/kg</p>
                            <p class="text-gray-600">Quantity: ${item.quantity}kg</p>
                        </div>
                        <button class="text-red-500 text-sm hover:underline mt-2" data-index="${index}">Remove</button>
                    `;
                    previewSection.appendChild(cropCard);

                    cropCard.querySelector('button').addEventListener('click', () => {
                        removeCrop(index);
                    });
                });
            }

            // Remove Crop
            function removeCrop(index) {
                crops.splice(index, 1);
                updatePreview();
                showAlert('Crop removed!', 'success');
            }

            // Clear Form
            function clearForm() {
                cropSelect.value = '';
                priceInput.value = '';
                quantityInput.value = '';
            }

            // Publish Marketplace
            publishBtn.addEventListener('click', () => {
                const storeName = storeNameInput.value.trim();
                if (!storeName) {
                    showAlert('Please enter a marketplace name!', 'error');
                    return;
                }
                if (crops.length === 0) {
                    showAlert('Please add at least one crop!', 'error');
                    return;
                }

                const storeData = { storeName, crops };
                console.log('Published Data:', storeData); // For debugging

                const shareableLink = `${window.location.origin}/store/${encodeURIComponent(storeName)}`;
                linkInput.value = shareableLink;
                shareLinkSection.classList.remove('hidden');
                showAlert('Marketplace published successfully!', 'success');
            });

            // Copy Link
            copyLinkBtn.addEventListener('click', () => {
                linkInput.select();
                document.execCommand('copy');
                showAlert('Link copied to clipboard!', 'success');
            });

            // Alert/Toast
            function showAlert(message, type) {
                const alert = document.createElement('div');
                alert.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white ${
                    type === 'success' ? 'bg-green-500' : 'bg-red-500'
                }`;
                alert.textContent = message;
                document.body.appendChild(alert);
                setTimeout(() => alert.remove(), 3000);
            }
        });
    </script>
</body>
</html>